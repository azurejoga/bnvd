name: BNVD Dependabot CVE Enricher

on:
  schedule:
    - cron: '0 */6 * * *'  # Executa a cada 6 horas
  workflow_dispatch:

permissions:
  security-events: read
  pull-requests: read
  contents: read

jobs:
  check-cves:
    runs-on: ubuntu-latest
    name: Check and Enrich CVEs from Dependabot

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: BNVD Dependabot CVE Enricher
        uses: ./.github/actions/bnvd-dependabot
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          bnvd_api_url: 'https://bnvd.org/api/v1'
          include_translations: 'true'
          severity_filter: 'ALL'
          create_issues: 'false'
          issue_labels: 'security,cve,bnvd'

      - name: Display Summary
        run: |
          echo "## BNVD Security Report" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          cat bnvd-security-report.md >> $GITHUB_STEP_SUMMARY || echo "No vulnerabilities found" >> $GITHUB_STEP_SUMMARY
