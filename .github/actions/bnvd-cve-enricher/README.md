# BNVD CVE Enricher GitHub Action

![Brand Icon](https://raw.githubusercontent.com/actions/setup-python/main/shield.svg) <!-- Usando um ícone genérico como placeholder -->

**BNVD CVE Enricher** é uma GitHub Action que automatiza a vigilância de segurança do seu repositório. Ela busca proativamente por alertas de segurança do **Dependabot** e do **CodeQL** que contenham um identificador CVE, e enriquece esses alertas com informações detalhadas e em português, obtidas diretamente do [Banco Nacional de Vulnerabilidades (BNVD)](https://bnvd.org.br/).

## Funcionalidades Principais

- **Análise Abrangente**: Consolida alertas de múltiplas fontes de segurança do GitHub (Dependabot e CodeQL).
- **Enriquecimento de Dados**: Traduz e adiciona detalhes valiosos às CVEs, como descrições em português e scores de severidade CVSS.
- **Relatórios Automatizados**: Gera um relatório conciso em Markdown (`bnvd-security-report.md`) com todas as vulnerabilidades encontradas, priorizadas por severidade.
- **Altamente Configurável**: Permite filtrar vulnerabilidades por nível de severidade (ex: `CRITICAL`, `HIGH`).
- **Pronto para o Marketplace**: Desenhado para ser facilmente compartilhado e utilizado em qualquer repositório.

## Exemplo de Uso

Crie um arquivo de workflow no seu repositório em `.github/workflows/security-scan.yml`:

```yaml
name: Análise de Segurança com BNVD

on:
  workflow_dispatch: # Permite execução manual
  schedule:
    - cron: '0 8 * * 1' # Executa toda segunda-feira às 8h

permissions:
  security-events: read # Necessário para ler alertas do Dependabot e CodeQL
  contents: read      # Necessário para fazer o checkout do código

jobs:
  enrich-vulnerabilities:
    runs-on: ubuntu-latest
    name: Buscar e Enriquecer Alertas de CVE

    steps:
      - name: Checkout do Código
        uses: actions/checkout@v4

      - name: BNVD CVE Enricher
        uses: ./actions/bnvd-cve-enricher # Substitua pelo seu {owner}/{repo}@v1 quando publicado
        id: bnvd-enricher
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          severity_filter: 'HIGH' # Ex: Apenas CRITICAL e HIGH

      - name: Fazer Upload do Relatório como Artefato
        if: always() # Executa mesmo se o passo anterior falhar
        uses: actions/upload-artifact@v4
        with:
          name: relatorio-de-seguranca-bnvd
          path: bnvd-security-report.md
          retention-days: 7

      - name: Adicionar Resumo do Job
        if: always()
        run: |
          echo "## Resumo da Análise de Segurança BNVD" >> $GITHUB_STEP_SUMMARY
          echo "Foram encontrados ${{ steps.bnvd-enricher.outputs.total_cves_found }} CVEs." >> $GITHUB_STEP_SUMMARY
          echo "${{ steps.bnvd-enricher.outputs.enriched_cves }} CVEs foram enriquecidos após filtragem." >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          # Adiciona o conteúdo do relatório ao resumo
          cat bnvd-security-report.md >> $GITHUB_STEP_SUMMARY || echo "Nenhum relatório gerado." >> $GITHUB_STEP_SUMMARY
```

## Entradas (Inputs)

| Parâmetro              | Descrição                                                                      | Obrigatório | Padrão                        |
| ---------------------- | ------------------------------------------------------------------------------ | ----------- | ----------------------------- |
| `github_token`         | Token para acessar as APIs de segurança do GitHub. Use `${{ secrets.GITHUB_TOKEN }}`. | `true`      | `N/A`                         |
| `bnvd_api_url`         | URL base da API do BNVD.                                                       | `false`     | `https://bnvd.org.br/api/v1`  |
| `include_translations` | Define se as descrições em português devem ser incluídas no relatório.         | `false`     | `true`                        |
| `severity_filter`      | Filtra alertas por severidade. Valores: `LOW`, `MEDIUM`, `HIGH`, `CRITICAL`, `ALL`. | `false`     | `ALL`                         |

## Saídas (Outputs)

| Parâmetro           | Descrição                                                                                 |
| ------------------- | ----------------------------------------------------------------------------------------- |
| `total_cves_found`  | O número total de alertas com CVEs encontrados (Dependabot e CodeQL).                     |
| `enriched_cves`     | O número de CVEs que foram enriquecidos com dados do BNVD e passaram no filtro de severidade. |
| `report_file`       | O caminho para o arquivo de relatório Markdown gerado (ex: `bnvd-security-report.md`).      |
| `cve_details`       | Uma string JSON com um resumo dos CVEs enriquecidos, incluindo a fonte (`Dependabot`/`CodeQL`). |

## Licença

Este projeto é distribuído sob a licença MIT. Veja o arquivo `LICENSE` para mais detalhes.
