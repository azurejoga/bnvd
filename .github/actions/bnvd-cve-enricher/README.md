# BNVD CVE Enricher Action

[![GitHub Marketplace](https://img.shields.io/badge/Marketplace-BNVD%20CVE%20Enricher-blue?logo=github)](https://github.com/marketplace/actions/bnvd-cve-enricher)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)

Esta Action busca por alertas de segurança do Dependabot e CodeQL em seu repositório, identifica os CVEs (Common Vulnerabilities and Exposures) e os enriquece com informações em português e dados de severidade da base de dados do [BNVD (Banco Nacional de Vulnerabilidades do Brasil)](https://bnvd.org.br/).

Ao final, a Action gera um relatório em Markdown (`.md`) com os detalhes das vulnerabilidades encontradas e enriquecidas.

## Funcionalidades

-   Busca alertas abertos do Dependabot e CodeQL.
-   Extrai automaticamente os identificadores CVE dos alertas.
-   Conecta-se à API do BNVD para obter descrições em português, scores de CVSS e níveis de severidade.
-   Filtra os alertas por severidade (LOW, MEDIUM, HIGH, CRITICAL).
-   Gera um relatório de segurança detalhado em formato Markdown.
-   Disponibiliza os resultados como outputs para integração com outros passos do seu workflow.

---

## Uso

Para usar esta Action, adicione o seguinte passo ao seu arquivo de workflow (ex: `.github/workflows/security.yml`).

```yaml
name: Análise de Segurança com BNVD

on:
  workflow_dispatch:
  schedule:
    - cron: '0 8 * * 1' # Executa toda segunda-feira às 8h UTC

# Permissões mínimas para a Action funcionar
permissions:
  security-events: read # Para ler alertas do Dependabot e CodeQL
  contents: write      # Para fazer o upload de artefatos e resumos

jobs:
  enrich-vulnerabilities:
    runs-on: ubuntu-latest
    name: Buscar e Enriquecer Alertas de CVE

    steps:
      - name: Checkout do Código
        uses: actions/checkout@v4

      - name: BNVD CVE Enricher
        # Substitua <SEU_USUARIO>/<SEU_REPO> pelo nome do seu repositório da Action
        # Use @v1 para garantir que você está usando uma versão estável
        uses: <SEU_USUARIO>/<SEU_REPO>@v1
        id: bnvd-enricher
        with:
          # O GITHUB_TOKEN é passado automaticamente e tem as permissões definidas no topo do workflow
          github_token: ${{ secrets.GITHUB_TOKEN }}
          # Filtra para mostrar apenas vulnerabilidades de severidade ALTA ou CRÍTICA
          severity_filter: 'HIGH'

      - name: Fazer Upload do Relatório como Artefato
        if: always() # Garante que o passo rode mesmo se a Action falhar
        uses: actions/upload-artifact@v4
        with:
          name: relatorio-de-seguranca-bnvd
          # O nome do arquivo é um output da Action
          path: ${{ steps.bnvd-enricher.outputs.report_file }}
          retention-days: 7

      - name: Adicionar Resumo ao Job Summary
        if: always()
        run: |
          echo "## Resumo da Análise de Segurança BNVD" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- **CVEs Totais Encontrados:** ${{ steps.bnvd-enricher.outputs.total_cves_found }}" >> $GITHUB_STEP_SUMMARY
          echo "- **CVEs Enriquecidos (Filtro: ${{ inputs.severity_filter || 'HIGH' }}):** ${{ steps.bnvd-enricher.outputs.enriched_cves }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          # Adiciona o conteúdo do relatório ao sumário para fácil visualização
          cat ${{ steps.bnvd-enricher.outputs.report_file }} >> $GITHUB_STEP_SUMMARY || echo "_Nenhum relatório foi gerado._" >> $GITHUB_STEP_SUMMARY

```

## Entradas (`inputs`)

| Parâmetro            | Descrição                                                                               | Obrigatório | Padrão                        |
| -------------------- | --------------------------------------------------------------------------------------- | ----------- | ----------------------------- |
| `github_token`         | Token do GitHub para acessar as APIs. Use `${{ secrets.GITHUB_TOKEN }}`.                 | `true`      | N/A                           |
| `bnvd_api_url`         | URL da API do BNVD.                                                                     | `false`     | `https://bnvd.org.br/api/v1`  |
| `include_translations` | Define se as descrições em português devem ser incluídas no relatório.                | `false`     | `'true'`                      |
| `severity_filter`      | Filtra alertas por severidade. Valores: `LOW`, `MEDIUM`, `HIGH`, `CRITICAL`, `ALL`.      | `false`     | `'ALL'`                       |

## Saídas (`outputs`)

| Parâmetro           | Descrição                                                                         |
| ------------------- | --------------------------------------------------------------------------------- |
| `total_cves_found`  | O número total de alertas com CVEs encontrados (Dependabot e CodeQL).             |
| `enriched_cves`     | O número de CVEs que foram enriquecidos com dados do BNVD e passaram no filtro.     |
| `report_file`       | O caminho para o arquivo de relatório Markdown gerado (`bnvd-security-report.md`). |
| `cve_details`       | Uma string JSON com um resumo dos CVEs enriquecidos.                               |

## Licença

Esta Action é distribuída sob a [Licença MIT](LICENSE).