{% extends "base.html" %}

{% block title %}BNVD API v1 - Documentação{% endblock %}

{% block meta_description %}Documentação completa da BNVD API v1 - Acesso programático ao Banco Nacional de Vulnerabilidades Cibernéticas{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-12">
            <h1 class="mb-4">
                <i class="fas fa-code"></i>
                BNVD API v1 - Documentação
            </h1>
            
            <div class="alert alert-info">
                <h5><i class="fas fa-info-circle"></i> Sobre a API</h5>
                <p class="mb-2">A BNVD API v1 é uma API REST que fornece acesso programático ao Banco Nacional de Vulnerabilidades Cibernéticas. Permite consultar vulnerabilidades de segurança, notícias de cibersegurança, dados do MITRE ATT&CK e obter estatísticas.</p>
                <p class="mb-0">
                    <strong>API Clients Oficiais:</strong> 
                    <a href="https://github.com/azurejoga/bnvd/tree/main/api_clients/javascript" target="_blank">JavaScript</a>, 
                    <a href="https://github.com/azurejoga/bnvd/tree/main/api_clients/php" target="_blank">PHP</a>, 
                    <a href="https://github.com/azurejoga/bnvd/tree/main/api_clients/ruby" target="_blank">Ruby</a>
                </p>
            </div>

            <!-- Base URL -->
            <div class="card mb-4">
                <div class="card-header">
                    <h3><i class="fas fa-link"></i> Base URL</h3>
                </div>
                <div class="card-body">
                    <code class="d-block p-3 bg-light border rounded">{{ request.url_root }}api/v1</code>
                </div>
            </div>

            <!-- Endpoints -->
            <div class="card mb-4">
                <div class="card-header">
                    <h3><i class="fas fa-list"></i> Endpoints Principais</h3>
                </div>
                <div class="card-body">
                    
                    <!-- Documentação da API -->
                    <div class="mb-4">
                        <h5 class="text-primary">
                            <span class="badge badge-success">GET</span>
                            /api/v1/
                        </h5>
                        <p>Retorna informações sobre a API e endpoints disponíveis.</p>
                    </div>

                    <!-- Listar Vulnerabilidades -->
                    <div class="mb-4">
                        <h5 class="text-primary">
                            <span class="badge badge-success">GET</span>
                            /api/v1/vulnerabilities
                        </h5>
                        <p>Lista todas as vulnerabilidades com suporte a paginação e filtros.</p>
                        <p><strong>Parâmetros:</strong></p>
                        <ul>
                            <li><code>page</code> (int): Número da página (padrão: 1)</li>
                            <li><code>per_page</code> (int): Resultados por página (padrão: 20, máximo: 100)</li>
                            <li><code>year</code> (int): Filtrar por ano específico</li>
                            <li><code>severity</code> (string): Filtrar por severidade CVSS</li>
                            <li><code>vendor</code> (string): Filtrar por vendor/fabricante</li>
                            <li><code>include_pt</code> (boolean): Incluir traduções em português</li>
                        </ul>
                    </div>

                    <!-- Buscar CVE específico -->
                    <div class="mb-4">
                        <h5 class="text-primary">
                            <span class="badge badge-success">GET</span>
                            /api/v1/vulnerabilities/&lt;cve_id&gt;
                        </h5>
                        <p>Busca uma vulnerabilidade específica pelo CVE ID.</p>
                        <p><strong>Exemplo:</strong> <code>/api/v1/vulnerabilities/CVE-2024-12345</code></p>
                    </div>

                    <!-- Vulnerabilidades Recentes -->
                    <div class="mb-4">
                        <h5 class="text-primary">
                            <span class="badge badge-success">GET</span>
                            /api/v1/search/recent
                        </h5>
                        <p>Busca vulnerabilidades publicadas nos últimos dias.</p>
                        <p><strong>Parâmetros:</strong> <code>days</code>, <code>page</code>, <code>per_page</code></p>
                    </div>

                    <!-- 5 Mais Recentes -->
                    <div class="mb-4">
                        <h5 class="text-primary">
                            <span class="badge badge-success">GET</span>
                            /api/v1/search/recent/5
                        </h5>
                        <p>Retorna as 5 vulnerabilidades mais recentes.</p>
                    </div>

                    <!-- Buscar por Ano -->
                    <div class="mb-4">
                        <h5 class="text-primary">
                            <span class="badge badge-success">GET</span>
                            /api/v1/search/year/&lt;year&gt;
                        </h5>
                        <p>Busca vulnerabilidades de um ano específico.</p>
                        <p><strong>Exemplo:</strong> <code>/api/v1/search/year/2024</code></p>
                    </div>

                    <!-- Buscar por Severidade -->
                    <div class="mb-4">
                        <h5 class="text-primary">
                            <span class="badge badge-success">GET</span>
                            /api/v1/search/severity/&lt;severity&gt;
                        </h5>
                        <p>Busca vulnerabilidades por severidade CVSS.</p>
                        <p><strong>Severidades:</strong> LOW, MEDIUM, HIGH, CRITICAL</p>
                        <p><strong>Exemplo:</strong> <code>/api/v1/search/severity/CRITICAL</code></p>
                    </div>

                    <!-- Buscar por Vendor -->
                    <div class="mb-4">
                        <h5 class="text-primary">
                            <span class="badge badge-success">GET</span>
                            /api/v1/search/vendor/&lt;vendor&gt;
                        </h5>
                        <p>Busca vulnerabilidades por vendor/fabricante.</p>
                        <p><strong>Exemplo:</strong> <code>/api/v1/search/vendor/microsoft</code></p>
                    </div>

                    <!-- Estatísticas -->
                    <div class="mb-4">
                        <h5 class="text-primary">
                            <span class="badge badge-success">GET</span>
                            /api/v1/stats
                        </h5>
                        <p>Retorna estatísticas gerais do banco de dados.</p>
                    </div>

                    <!-- Estatísticas por Ano -->
                    <div class="mb-4">
                        <h5 class="text-primary">
                            <span class="badge badge-success">GET</span>
                            /api/v1/stats/years
                        </h5>
                        <p>Retorna estatísticas detalhadas por ano.</p>
                    </div>

                    <hr class="my-4">
                    <h4 class="text-info mb-3">Notícias de Cibersegurança</h4>

                    <!-- Listar Notícias -->
                    <div class="mb-4">
                        <h5 class="text-primary">
                            <span class="badge badge-success">GET</span>
                            /api/v1/noticias
                        </h5>
                        <p>Lista todas as notícias de segurança cibernética com paginação.</p>
                        <p><strong>Parâmetros:</strong></p>
                        <ul>
                            <li><code>page</code> (int): Número da página (padrão: 1)</li>
                            <li><code>per_page</code> (int): Resultados por página (padrão: 20, máximo: 100)</li>
                        </ul>
                    </div>

                    <!-- Notícias Recentes -->
                    <div class="mb-4">
                        <h5 class="text-primary">
                            <span class="badge badge-success">GET</span>
                            /api/v1/noticias/recentes
                        </h5>
                        <p>Retorna as notícias mais recentes.</p>
                        <p><strong>Parâmetros:</strong> <code>limit</code> (int, padrão: 5)</p>
                    </div>

                    <!-- Notícia por Slug -->
                    <div class="mb-4">
                        <h5 class="text-primary">
                            <span class="badge badge-success">GET</span>
                            /api/v1/noticias/&lt;slug&gt;
                        </h5>
                        <p>Retorna uma notícia específica pelo slug.</p>
                    </div>

                    <hr class="my-4">
                    <h4 class="text-info mb-3">MITRE ATT&CK Framework</h4>

                    <!-- Info MITRE -->
                    <div class="mb-4">
                        <h5 class="text-primary">
                            <span class="badge badge-success">GET</span>
                            /api/v1/mitre
                        </h5>
                        <p>Retorna informações sobre os endpoints MITRE ATT&CK disponíveis.</p>
                    </div>

                    <!-- Matrizes MITRE -->
                    <div class="mb-4">
                        <h5 class="text-primary">
                            <span class="badge badge-success">GET</span>
                            /api/v1/mitre/matrices
                        </h5>
                        <p>Lista todas as matrizes MITRE ATT&CK disponíveis (enterprise, mobile, ics, pre-attack).</p>
                    </div>

                    <!-- Matriz Específica -->
                    <div class="mb-4">
                        <h5 class="text-primary">
                            <span class="badge badge-success">GET</span>
                            /api/v1/mitre/matrix/&lt;type&gt;
                        </h5>
                        <p>Retorna dados completos de uma matriz específica.</p>
                        <p><strong>Tipos:</strong> enterprise, mobile, ics, pre-attack</p>
                        <p><strong>Parâmetros:</strong> <code>translate</code> (boolean) - Traduzir para português</p>
                    </div>

                    <!-- Técnicas MITRE -->
                    <div class="mb-4">
                        <h5 class="text-primary">
                            <span class="badge badge-success">GET</span>
                            /api/v1/mitre/techniques
                        </h5>
                        <p>Lista todas as técnicas MITRE ATT&CK.</p>
                        <p><strong>Parâmetros:</strong></p>
                        <ul>
                            <li><code>matrix</code> (string): Filtrar por matriz (enterprise, mobile, ics, pre-attack)</li>
                            <li><code>tactic</code> (string): Filtrar por tática</li>
                            <li><code>platform</code> (string): Filtrar por plataforma</li>
                            <li><code>translate</code> (boolean): Traduzir para português</li>
                        </ul>
                    </div>

                    <!-- Técnica Específica -->
                    <div class="mb-4">
                        <h5 class="text-primary">
                            <span class="badge badge-success">GET</span>
                            /api/v1/mitre/technique/&lt;id&gt;
                        </h5>
                        <p>Retorna detalhes de uma técnica específica (ex: T1566).</p>
                        <p><strong>Parâmetros:</strong> <code>translate</code> (boolean)</p>
                    </div>

                    <!-- Subtécnicas -->
                    <div class="mb-4">
                        <h5 class="text-primary">
                            <span class="badge badge-success">GET</span>
                            /api/v1/mitre/subtechniques
                        </h5>
                        <p>Lista todas as subtécnicas MITRE ATT&CK.</p>
                        <p><strong>Parâmetros:</strong> <code>matrix</code>, <code>translate</code></p>
                    </div>

                    <!-- Grupos -->
                    <div class="mb-4">
                        <h5 class="text-primary">
                            <span class="badge badge-success">GET</span>
                            /api/v1/mitre/groups
                        </h5>
                        <p>Lista todos os grupos de ameaças MITRE ATT&CK.</p>
                        <p><strong>Parâmetros:</strong> <code>matrix</code>, <code>translate</code></p>
                    </div>

                    <!-- Grupo Específico -->
                    <div class="mb-4">
                        <h5 class="text-primary">
                            <span class="badge badge-success">GET</span>
                            /api/v1/mitre/group/&lt;id&gt;
                        </h5>
                        <p>Retorna detalhes de um grupo específico (ex: G0001).</p>
                        <p><strong>Parâmetros:</strong> <code>translate</code> (boolean)</p>
                    </div>

                    <!-- Mitigações -->
                    <div class="mb-4">
                        <h5 class="text-primary">
                            <span class="badge badge-success">GET</span>
                            /api/v1/mitre/mitigations
                        </h5>
                        <p>Lista todas as mitigações MITRE ATT&CK.</p>
                        <p><strong>Parâmetros:</strong> <code>matrix</code>, <code>translate</code></p>
                    </div>

                    <!-- Mitigação Específica -->
                    <div class="mb-4">
                        <h5 class="text-primary">
                            <span class="badge badge-success">GET</span>
                            /api/v1/mitre/mitigation/&lt;id&gt;
                        </h5>
                        <p>Retorna detalhes de uma mitigação específica (ex: M1001).</p>
                        <p><strong>Parâmetros:</strong> <code>translate</code> (boolean)</p>
                    </div>
                </div>
            </div>

            <!-- Formato de Resposta -->
            <div class="card mb-4">
                <div class="card-header">
                    <h3><i class="fas fa-code"></i> Formato de Resposta</h3>
                </div>
                <div class="card-body">
                    <h5>Resposta de Sucesso</h5>
                    <pre><code>{
  "status": "success",
  "data": [...],
  "pagination": {
    "page": 1,
    "per_page": 20,
    "total": 100,
    "pages": 5,
    "has_next": true,
    "has_prev": false
  }
}</code></pre>

                    <h5 class="mt-4">Resposta de Erro</h5>
                    <pre><code>{
  "status": "error",
  "message": "Descrição do erro",
  "code": 400
}</code></pre>
                </div>
            </div>

            <!-- Exemplos de Integração -->
            <div class="card mb-4">
                <div class="card-header">
                    <h3><i class="fas fa-code-branch"></i> Exemplos de Integração</h3>
                </div>
                <div class="card-body">
                    <p class="alert alert-success">
                        <strong>API Clients Oficiais:</strong> Utilize nossos clients oficiais para facilitar a integração:
                    </p>
                    <ul>
                        <li><a href="https://github.com/azurejoga/bnvd/tree/main/api_clients/javascript" target="_blank"><strong>JavaScript/Node.js</strong></a> - Cliente completo com suporte a TypeScript</li>
                        <li><a href="https://github.com/azurejoga/bnvd/tree/main/api_clients/php" target="_blank"><strong>PHP</strong></a> - Cliente com suporte a Composer</li>
                        <li><a href="https://github.com/azurejoga/bnvd/tree/main/api_clients/ruby" target="_blank"><strong>Ruby</strong></a> - Gem com interface idiomática</li>
                    </ul>

                    <!-- cURL -->
                    <h5 class="mt-4">Exemplos cURL</h5>
                    <pre><code># Listar vulnerabilidades
curl "https://bnvd.org/api/v1/vulnerabilities?per_page=10"

# Buscar por severidade
curl "https://bnvd.org/api/v1/search/severity/CRITICAL"

# Obter estatísticas
curl "https://bnvd.org/api/v1/stats"

# Listar notícias recentes
curl "https://bnvd.org/api/v1/noticias/recentes?limit=5"

# Obter matriz MITRE Enterprise
curl "https://bnvd.org/api/v1/mitre/matrix/enterprise"

# Listar técnicas MITRE
curl "https://bnvd.org/api/v1/mitre/techniques?matrix=enterprise&translate=true"
</code></pre>
                </div>
            </div>

            <!-- Códigos de Status -->
            <div class="card mb-4">
                <div class="card-header">
                    <h3><i class="fas fa-info"></i> Códigos de Status HTTP</h3>
                </div>
                <div class="card-body">
                    <ul class="list-unstyled">
                        <li><span class="badge badge-success">200</span> <strong>OK</strong> - Sucesso</li>
                        <li><span class="badge badge-warning">400</span> <strong>Bad Request</strong> - Parâmetros inválidos</li>
                        <li><span class="badge badge-danger">404</span> <strong>Not Found</strong> - Recurso não encontrado</li>
                        <li><span class="badge badge-dark">500</span> <strong>Internal Server Error</strong> - Erro interno do servidor</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}